# .github/workflows/run-checks.yml

# Name of the workflow, which will be displayed in the "Actions" tab on GitHub
name: CI Checks

# ---
# This section defines when the workflow will automatically run.
# ---
on:
  # Run on every push to ANY branch
  push:
    branches: [ "**" ]
  # Run on every pull request targeting ANY branch
  pull_request:
    branches: [ "**" ]

# ---
# This section defines the jobs to be executed.
# ---
jobs:
  # Job 1: Job for running tests
  build-and-test:
    # ---
    # The runner environment.
    # Because your project includes an iOS target (iosSimulatorArm64),
    # you MUST use a macOS runner.
    # ---
    runs-on: macos-latest

    # ---
    # The sequence of steps the job will perform.
    # ---
    steps:
      # Step 1: Check out the repository's code
      # This downloads your project code onto the runner.
      - name: Check out code
        uses: actions/checkout@v4

      # Step 2: Set up the Java Development Kit (JDK)
      # Kotlin Multiplatform projects require a JDK to run Gradle.
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          # This is an important optimization: it caches Gradle dependencies
          # to make subsequent workflow runs much faster.
          cache: 'gradle'

      # Step 3: Grant execute permission to the Gradle Wrapper
      # On Unix-based systems (like macOS), the gradlew script needs to be executable.
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      # Step 4: Run the 'check' command
      # This is the exact command you fixed. It compiles the code and runs all
      # verification tasks, including tests, for ALL targets (JVM, Android, iOS, etc.).
      - name: Run all checks with Gradle
        run: ./gradlew check

  # Job 2: Job to run assembleDebug
  assemble-debug:
    runs-on: macos-latest # Use the same runner
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      - name: Run assembleDebug with Gradle
        run: ./gradlew assembleDebug

  # Job 3: Job to run lint
  lint:
    runs-on: macos-latest # Use the same runner
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      - name: Run lint with Gradle
        run: ./gradlew lint
